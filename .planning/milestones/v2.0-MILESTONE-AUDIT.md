---
milestone: v2
audited: 2026-02-18T12:00:00Z
status: tech_debt
scores:
  requirements: 10/10
  phases: 2/2
  integration: 17/18
  flows: 6/6
gaps: []
tech_debt:
  - phase: 07-agent-toolkit-orchestrator
    items:
      - "Dead code: _effective_autonomy(policy_autonomy) parameter never exercised — always called with no argument"
      - "Dead defensive code: try/except ImportError around ToolCall import in toolkit/__init__.py (orchestrator always exists)"
      - "ProposalDecision not re-exported from top-level tract/__init__.py (available via tract.orchestrator)"
  - phase: cross-phase
    items:
      - "7 files with uncommitted changes in working tree (post-Phase 7 polish)"
---

# v2 Milestone Audit: Autonomous Context Management

**Milestone:** v2 — Autonomous Context Management (Phases 6-7)
**Audited:** 2026-02-18
**Status:** tech_debt (all requirements met, minor accumulated debt)

## Milestone Definition of Done

From ROADMAP.md: "Phase 6: Policy Engine — Rule/trigger system for automatic context operations with configurable policies and human override. Phase 7: Agent Toolkit & Orchestrator — Expose Tract operations as agent tools with customizable prompts/profiles, ship a lightweight policy-integrated orchestrator as reference implementation, complete the autonomy spectrum."

## Phase Verification Summary

| Phase | Status | Score | Tests | Date |
|-------|--------|-------|-------|------|
| 6. Policy Engine | PASSED | 10/10 must-haves | 113 new (798 total) | 2026-02-18 |
| 7. Agent Toolkit & Orchestrator | PASSED | 9/9 must-haves | 90 new (888 total) | 2026-02-18 |

Both phase VERIFICATION.md files present and passed. No unverified phases.

## Requirements Coverage

| Requirement | Description | Phase | Status | Evidence |
|-------------|-------------|-------|--------|----------|
| AUTO-01 | Declarative policies with triggers/thresholds/actions | 6 | SATISFIED | Policy ABC, PolicyEvaluator, configure_policies() |
| AUTO-02 | Auto-compress at budget threshold | 6 | SATISFIED | CompressPolicy fires at 90% budget, preserves pinned |
| AUTO-03 | Auto-pin via content type heuristics | 6 | SATISFIED | PinPolicy auto-pins instruction/session, retroactive_scan() |
| AUTO-04 | Auto-branch for tangent detection | 6 | SATISFIED | BranchPolicy detects content_type transitions |
| AUTO-05 | Auto-rebase for stale branches | 6 | SATISFIED | RebasePolicy checks age + commit count |
| AUTO-06 | Human override at any point | 6 | SATISFIED | pause/resume_all_policies, approve/reject_proposal |
| AUTO-07 | Agent toolkit with tools/profiles | 7 | SATISFIED | 15 tools, 3 profiles, ToolExecutor, as_tools() facade |
| AUTO-08 | Operation proposals with reasoning | 7 | SATISFIED | OrchestratorProposal with reasoning/alternatives |
| AUTO-09 | Autonomous execution end-to-end | 7 | SATISFIED | Orchestrator loop with AUTONOMOUS ceiling |
| AUTO-10 | Human can stop/pause without data loss | 7 | SATISFIED | stop()/pause() with _orchestrating guard + finally cleanup |

**Score: 10/10 requirements satisfied**

## Cross-Phase Integration

| From | To | Connection | Status |
|------|-----|-----------|--------|
| Phase 6 PolicyEvaluator | Phase 7 Orchestrator | _orchestrating flag guards policy eval during orchestration | WIRED |
| Phase 7 Orchestrator | Phase 6 PolicyEvaluator | Triggers invoke orchestrator from commit/compile | WIRED |
| Phase 6 CompressPolicy | Phase 4 compress_range() | _dispatch_action calls tract.compress() | WIRED |
| Phase 6 BranchPolicy | Phase 3 branch ops | _dispatch_action calls tract.branch() | WIRED |
| Phase 7 Toolkit | Phase 4 Compression | compress handler calls tract.compress() | WIRED |
| Phase 7 Toolkit | Phase 3 Merge | merge handler calls tract.merge() | WIRED |
| Phase 7 Toolkit | Phase 2 Navigation | status/log/diff/reset/checkout handlers | WIRED |
| Phase 7 Toolkit | Phase 1 Core | commit/compile/annotate handlers | WIRED |
| Phase 6 Config Persistence | Phase 7 Auto-load | save_policy_config -> Tract.open() load | WIRED |
| Phase 7 ToolExecutor | Phase 7 Orchestrator | Orchestrator creates ToolExecutor for dispatch | WIRED |
| Phase 7 Assessment | Phase 2 Status/Log | build_context_assessment calls status/log/list_branches | WIRED |
| Phase 7 Callbacks | Phase 7 Models | Callbacks accept OrchestratorProposal, return ProposalResponse | WIRED |
| Phase 7 Prompts | Phase 7 Assessment | build_assessment_prompt formats assessment data | WIRED |
| Phase 6 -> Phase 7 autonomy ceiling | _effective_autonomy(policy_autonomy) | Parameter exists but never called with argument | GAP (dead code) |

**No circular imports found.** All cross-phase imports use lazy imports and TYPE_CHECKING guards correctly.

**Score: 17/18 connections verified (1 gap — dead parameter, not a runtime failure)**

## E2E Flow Verification

| Flow | Path | Status |
|------|------|--------|
| Auto-compress | commit -> policy eval -> threshold exceeded -> compress triggered | COMPLETE |
| Auto-pin | commit -> policy eval -> content type match -> pinned | COMPLETE |
| Orchestrator autonomous | trigger -> assessment -> LLM -> tools -> result | COMPLETE |
| Orchestrator collaborative | trigger -> proposal -> callback -> approve/reject | COMPLETE |
| Human override | pause_all_policies / stop_orchestrator -> immediate halt | COMPLETE |
| Config persistence | save -> restart -> auto-load -> policies active | COMPLETE |

**Score: 6/6 flows complete**

## Tech Debt

### Phase 7: Agent Toolkit & Orchestrator

1. **Dead code: `_effective_autonomy(policy_autonomy)` parameter** — `loop.py` lines 517-544. The `policy_autonomy` parameter and the min-computation branch are never exercised. `_execute_tool_call()` always calls `_effective_autonomy()` with no argument. The autonomy ceiling works correctly as a static config-time value, but the spec's "min(ceiling, policy)" dynamic computation is unreachable. Not a runtime failure.

2. **Dead defensive code: `try/except ImportError`** — `toolkit/__init__.py` lines 18-21. The `ToolCall` import from `orchestrator.models` has an `ImportError` fallback to `None` that is never triggered since `orchestrator.models` always exists. Leftover from phased development.

3. **`ProposalDecision` missing from top-level exports** — Available via `from tract.orchestrator import ProposalDecision` but not re-exported in `tract/__init__.py`'s `__all__`. All other orchestrator types are re-exported at the top level.

### Cross-Phase

4. **7 uncommitted files in working tree** — Post-Phase 7 polish changes to assessment.py, callbacks.py, config.py, loop.py, definitions.py, tract.py, and test_orchestrator.py. These should be committed or stashed.

### Total: 4 items across 2 categories

## Architecture Summary

The v2 milestone delivers a complete autonomy spectrum for context management:

```
Manual ──────── Collaborative ──────── Autonomous
  │                    │                    │
  │  User does         │  System proposes,  │  System executes
  │  everything        │  user approves     │  end-to-end
  │                    │                    │
  ├─ Policy Engine ────┼────────────────────┤
  │  (Phase 6)         │                    │
  │  4 built-in        │  Proposals with    │  Dispatch actions
  │  policies          │  approve/reject    │  directly
  │                    │                    │
  ├─ Orchestrator ─────┼────────────────────┤
  │  (Phase 7)         │                    │
  │  Skip all tools    │  Propose + callback│  Execute tools
  │                    │                    │  directly
  └────────────────────┴────────────────────┘
```

**Key deliverables:**
- 6 plans executed across 2 phases
- 203 new tests (113 policy + 90 toolkit/orchestrator)
- 888 total tests passing
- 10/10 AUTO requirements satisfied
- Full policy -> orchestrator integration with trigger-based auto-invocation

## Conclusion

All milestone requirements are met. No critical blockers. 4 minor tech debt items (dead code, missing export, uncommitted changes) — none affect runtime behavior or user-facing functionality.
