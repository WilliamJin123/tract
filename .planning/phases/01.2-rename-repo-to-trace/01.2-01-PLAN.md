---
phase: 01.2-rename-repo-to-trace
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  # Source renames and modifications
  - src/tract/repo.py              # deleted (renamed to tract.py)
  - src/tract/tract.py             # created (renamed from repo.py)
  - src/tract/__init__.py
  - src/tract/models/__init__.py
  - src/tract/models/config.py     # RepoConfig -> TractConfig
  - src/tract/models/commit.py     # repo_id -> tract_id
  - src/tract/models/annotations.py # repo_id -> tract_id
  - src/tract/protocols.py         # repo_id -> tract_id in ContextCompiler
  - src/tract/engine/commit.py     # repo_id -> tract_id
  - src/tract/engine/compiler.py   # repo_id -> tract_id
  - src/tract/storage/schema.py    # repo_id column -> tract_id
  - src/tract/storage/repositories.py # repo_id params -> tract_id
  - src/tract/storage/sqlite.py    # repo_id -> tract_id
  # Test renames and modifications
  - tests/test_repo.py             # deleted (renamed to test_tract.py)
  - tests/test_tract.py            # created (renamed from test_repo.py)
  - tests/conftest.py              # sample_repo_id -> sample_tract_id
  - tests/test_engine/test_commit.py
  - tests/test_engine/test_compiler.py
  - tests/test_storage/test_repositories.py
  - tests/test_storage/test_schema.py
autonomous: true

must_haves:
  truths:
    - "Tract.open() is the entry point; Repo class no longer exists anywhere in source"
    - "tract_id replaces repo_id in all models, storage, engine, and protocols"
    - "repo.py renamed to tract.py; test_repo.py renamed to test_tract.py"
    - "RepoConfig renamed to TractConfig everywhere"
    - "All 220 existing tests pass with the new names"
    - "Planning docs and MEMORY.md reference Tract not Repo"
  artifacts:
    - path: "src/tract/tract.py"
      provides: "Tract class (renamed from Repo)"
      contains: "class Tract"
    - path: "src/tract/__init__.py"
      provides: "Package re-exports with Tract"
      contains: "from tract.tract import Tract"
    - path: "src/tract/models/config.py"
      provides: "TractConfig (renamed from RepoConfig)"
      contains: "class TractConfig"
    - path: "tests/test_tract.py"
      provides: "Integration tests using Tract class"
      contains: "Tract.open"
  key_links:
    - from: "src/tract/__init__.py"
      to: "src/tract/tract.py"
      via: "from tract.tract import Tract"
      pattern: "from tract\\.tract import Tract"
    - from: "src/tract/tract.py"
      to: "src/tract/protocols.py"
      via: "ContextCompiler.compile(tract_id=...)"
      pattern: "tract_id"
    - from: "src/tract/storage/schema.py"
      to: "src/tract/storage/sqlite.py"
      via: "DB column tract_id used in queries"
      pattern: "tract_id"
---

<objective>
Rename the public SDK entry point from `Repo` to `Tract` and `repo_id` to `tract_id` across all source, tests, and planning docs. Also rename `RepoConfig` to `TractConfig`.

Purpose: The class name `Repo` implies a shared container, but each agent's context is self-contained. `Tract` aligns with the package name (`import tract`) for a clean `from tract import Tract` API. This must happen now -- before Phases 2-5 build more surface area on top.

Output: All source files, test files, and documentation use `Tract`/`tract_id`/`TractConfig` consistently. 220 tests pass.
</objective>

<execution_context>
@C:\Users\jinwi\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\jinwi\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename Repo to Tract, repo_id to tract_id, RepoConfig to TractConfig in all source and test files</name>
  <files>
    src/tract/repo.py -> src/tract/tract.py (git mv)
    tests/test_repo.py -> tests/test_tract.py (git mv)
    src/tract/__init__.py
    src/tract/models/__init__.py
    src/tract/models/config.py
    src/tract/models/commit.py
    src/tract/models/annotations.py
    src/tract/protocols.py
    src/tract/engine/commit.py
    src/tract/engine/compiler.py
    src/tract/storage/schema.py
    src/tract/storage/repositories.py
    src/tract/storage/sqlite.py
    tests/conftest.py
    tests/test_engine/test_commit.py
    tests/test_engine/test_compiler.py
    tests/test_storage/test_repositories.py
    tests/test_storage/test_schema.py
  </files>
  <action>
    This is a mechanical find-and-replace rename. Execute ALL replacements in a single pass before running tests. The specific renames:

    **File renames (use `git mv`):**
    1. `git mv src/tract/repo.py src/tract/tract.py`
    2. `git mv tests/test_repo.py tests/test_tract.py`

    **Class/type renames (in all .py files under src/tract/ and tests/):**
    3. `class Repo:` -> `class Tract:` (in tract.py only)
    4. `Repo.open` -> `Tract.open` (everywhere)
    5. `Repo.from_components` -> `Tract.from_components` (everywhere)
    6. `-> Repo:` / `-> "Repo":` return type annotations -> `-> Tract:` / `-> "Tract":`
    7. `Repo(` constructor calls -> `Tract(` (in __init__.py re-exports and tests)
    8. `from tract.repo import Repo` -> `from tract.tract import Tract`
    9. `RepoConfig` -> `TractConfig` (class definition in config.py, all imports, all usages)
    10. `"Repo"` in `__all__` -> `"Tract"` in `__init__.py`
    11. `"RepoConfig"` in `__all__` -> `"TractConfig"`

    **Field/parameter renames (in all .py files under src/tract/ and tests/):**
    12. `repo_id` -> `tract_id` everywhere it appears as:
        - Pydantic field names (CommitInfo.repo_id, PriorityAnnotation.repo_id)
        - SQLAlchemy column names (CommitRow.repo_id, RefRow.repo_id, AnnotationRow.repo_id)
        - SQLAlchemy index names containing "repo" (ix_commits_repo_time -> ix_commits_tract_time, ix_commits_repo_type -> ix_commits_tract_type)
        - Function parameters (in repositories.py ABCs, sqlite.py implementations, engine/commit.py, engine/compiler.py, protocols.py)
        - Instance attributes (self._repo_id -> self._tract_id in tract.py)
        - Property definitions (def repo_id -> def tract_id in tract.py)
        - Constructor kwargs (repo_id= -> tract_id=)
        - Test fixture names (sample_repo_id -> sample_tract_id in conftest.py)
        - Test variable names and string literals containing "repo_id" or "repo-" or "test-repo"

    **Docstring/comment updates:**
    13. Update all docstrings that mention "Repo", "repo", "repo_id" to say "Tract", "tract", "tract_id"
    14. Module docstrings at top of renamed files

    **What NOT to rename:**
    - Do NOT rename the package `tract` -- it stays as `tract`
    - Do NOT rename `CommitRepository`, `BlobRepository`, `RefRepository`, `AnnotationRepository` -- these are storage-layer ABCs following the repository pattern, not related to the "Repo" SDK class
    - Do NOT rename `SqliteCommitRepository`, `SqliteBlobRepository`, etc. -- same reason
    - Do NOT rename `commit_repo`, `blob_repo`, `ref_repo`, `annotation_repo` variables -- these refer to storage repositories, not the SDK Repo class
    - Do NOT rename any fixture named `commit_repo`, `blob_repo`, `ref_repo`, `annotation_repo`

    **CRITICAL: After ALL replacements, check `git diff` for any accidental `tract` -> `trace` renames by the external linter. If found, `git checkout` those specific lines.**

    **Order of operations:**
    1. Do `git mv` for the two file renames first
    2. Then do all content replacements across all files in a single pass
    3. Then run `python -m pytest tests/ -x -q` to verify all 220 tests pass
  </action>
  <verify>
    Run `python -m pytest tests/ -x -q` -- expect 220 tests passing, 0 failures.
    Run `grep -r "class Repo" src/tract/` -- expect 0 matches.
    Run `grep -r "repo_id" src/tract/ tests/` -- expect 0 matches (excluding storage repository pattern names like commit_repo).
    Run `grep -rw "RepoConfig" src/tract/ tests/` -- expect 0 matches.
    Run `python -c "from tract import Tract; print(Tract)"` -- should print the Tract class.
    Run `python -c "from tract import TractConfig; print(TractConfig)"` -- should print the TractConfig class.
    Run `git diff --name-only` to verify no unintended `tract`->`trace` renames crept in.
  </verify>
  <done>
    - `class Tract` exists in `src/tract/tract.py`; `class Repo` and `src/tract/repo.py` no longer exist
    - `tract_id` replaces `repo_id` in all models (CommitInfo, PriorityAnnotation), storage schema (CommitRow, RefRow, AnnotationRow), engine, protocols, and tests
    - `TractConfig` replaces `RepoConfig` in config.py, __init__.py re-exports, and all usages
    - `tests/test_tract.py` exists; `tests/test_repo.py` no longer exists
    - `from tract import Tract, TractConfig` works
    - All 220 existing tests pass
  </done>
</task>

<task type="auto">
  <name>Task 2: Update planning docs and MEMORY.md to reflect new terminology</name>
  <files>
    .planning/STATE.md
    .planning/ROADMAP.md
    C:\Users\jinwi\.claude\projects\C--Users-jinwi-programming-files-NEW-Trace\memory\MEMORY.md
  </files>
  <action>
    Update references in planning docs and memory. This is a lighter-weight pass -- only update references that would be misleading or incorrect for future phases.

    **MEMORY.md updates:**
    - Change "Repo" references to "Tract" where they refer to the SDK class (e.g., "Repo.open()" -> "Tract.open()")
    - Change "repo_id" references to "tract_id"
    - Change "RepoConfig" to "TractConfig"
    - Add decision entry: "[01.2-01]: Repo renamed to Tract, repo_id to tract_id, RepoConfig to TractConfig"
    - Update "File Structure" section: `repo.py` -> `tract.py`, `test_repo.py` -> `test_tract.py`
    - Update "Phase 1.2 Status" to reflect completion

    **STATE.md updates:**
    - Update "Current Position" to show Phase 1.2
    - Add decision: `[01.2-01]: Repo -> Tract, repo_id -> tract_id, RepoConfig -> TractConfig across all source and tests`
    - Update "Repo.open()" references in decisions to "Tract.open()"

    **ROADMAP.md updates:**
    - Update Phase 1 success criteria that mention "Repo.open()" to say "Tract.open()"
    - The Phase 1.2 section itself can note that the rename is complete once plans are checked off

    **What NOT to update in planning docs:**
    - Do NOT rewrite historical plan summaries (01-01-SUMMARY.md, etc.) -- they are historical records
    - Do NOT update PLAN.md files for completed phases -- they are archived
    - Do NOT update VERIFICATION.md files -- they verified the state at time of completion
    - Do NOT update research docs -- they are reference artifacts
  </action>
  <verify>
    Run `grep -rw "Repo\b" .planning/STATE.md .planning/ROADMAP.md` -- should only appear in historical context (phase names, plan descriptions), not as current API references.
    Verify MEMORY.md contains "Tract.open()" not "Repo.open()" for current API.
    Verify MEMORY.md contains the new decision entry for 01.2-01.
  </verify>
  <done>
    - MEMORY.md reflects Tract/tract_id/TractConfig as current terminology
    - STATE.md has new decision logged and current position updated
    - ROADMAP.md success criteria reference Tract.open() where appropriate
    - Historical planning docs left untouched
  </done>
</task>

</tasks>

<verification>
1. `python -m pytest tests/ -x -q` -- 220 tests pass
2. `python -c "from tract import Tract, TractConfig"` -- imports succeed
3. `grep -rw "class Repo" src/tract/` -- 0 matches
4. `grep -rw "repo_id" src/tract/ tests/` -- 0 matches (excluding commit_repo/blob_repo/ref_repo/annotation_repo variable names)
5. `grep -rw "RepoConfig" src/tract/ tests/` -- 0 matches
6. `ls src/tract/repo.py tests/test_repo.py 2>/dev/null` -- both should not exist
7. `ls src/tract/tract.py tests/test_tract.py` -- both should exist
8. `git diff` shows no accidental tract->trace renames from external linter
</verification>

<success_criteria>
- Tract.open() is the entry point; Repo class no longer exists in any source file
- tract_id replaces repo_id in all models, storage, engine, protocols, and tests
- TractConfig replaces RepoConfig everywhere
- repo.py renamed to tract.py; test_repo.py renamed to test_tract.py
- All 220 existing tests pass with the new names
- Planning docs and MEMORY.md updated to reflect new terminology
</success_criteria>

<output>
After completion, create `.planning/phases/01.2-rename-repo-to-trace/01.2-01-SUMMARY.md`
</output>
