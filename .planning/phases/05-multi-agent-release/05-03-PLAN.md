---
phase: 05-multi-agent-release
plan: 03
type: execute
wave: 3
depends_on: ["05-02"]
files_modified:
  - pyproject.toml
  - src/tract/__init__.py
  - src/tract/_version.py
  - README.md
  - tests/test_integration_multiagent.py
autonomous: true

must_haves:
  truths:
    - "pip install -e . succeeds and import tract works"
    - "pip install -e '.[cli]' succeeds and tract CLI entry point works"
    - "README.md has quickstart, single-agent example, multi-agent example, and API reference outline"
    - "End-to-end multi-agent integration test covers spawn, commit, collapse, cross-repo query, crash recovery"
    - "All public API types are exported from tract.__init__"
    - "pyproject.toml has correct distribution name (tract-ai), dependencies, and metadata"
    - "Version is set to 0.1.0 as first release"
  artifacts:
    - path: "pyproject.toml"
      provides: "Package configuration with correct name, deps, metadata"
      contains: "tract-ai"
    - path: "README.md"
      provides: "Documentation with quickstart and examples"
      contains: "pip install tract-ai"
    - path: "tests/test_integration_multiagent.py"
      provides: "End-to-end multi-agent integration test"
      contains: "test_full_multiagent_workflow"
    - path: "src/tract/__init__.py"
      provides: "Complete public API exports"
      contains: "Session"
  key_links:
    - from: "pyproject.toml"
      to: "src/tract/__init__.py"
      via: "Package build includes all exported modules"
      pattern: "packages.*tract"
    - from: "README.md"
      to: "src/tract/__init__.py"
      via: "README examples use the public API"
      pattern: "from tract import"
    - from: "tests/test_integration_multiagent.py"
      to: "src/tract/session.py"
      via: "Integration test exercises Session.open, spawn, collapse, resume"
      pattern: "Session.open"
---

<objective>
Finalize packaging, write documentation, and create end-to-end integration tests for the complete multi-agent workflow.

Purpose: INTF-05 requires a pip-installable package with documentation and examples. This plan updates pyproject.toml with the final distribution name (tract-ai), writes a README with quickstart and examples, ensures all public API types are exported, and adds integration tests that exercise the complete multi-agent workflow end-to-end.

Output: Updated pyproject.toml with tract-ai distribution name, comprehensive README.md, end-to-end integration tests, and verified pip-installability. All ~631 tests plus ~15 new integration tests pass.
</objective>

<execution_context>
@C:\Users\jinwi\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\jinwi\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-multi-agent-release/05-CONTEXT.md
@.planning/phases/05-multi-agent-release/05-RESEARCH.md
@.planning/phases/05-multi-agent-release/05-02-SUMMARY.md
@pyproject.toml
@src/tract/__init__.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Package configuration and public API audit</name>
  <files>
    pyproject.toml
    src/tract/__init__.py
    src/tract/_version.py
  </files>
  <action>
    **pyproject.toml** -- Update package configuration for release:

    1. Change `name = "trace-context"` to `name = "tract-ai"` (PyPI distribution name)
    2. Ensure version is `"0.1.0"` (first release)
    3. Add complete project metadata:
       ```toml
       authors = [{name = "Trace Contributors"}]
       keywords = ["llm", "context", "version-control", "agents", "multi-agent"]
       classifiers = [
           "Development Status :: 3 - Alpha",
           "Intended Audience :: Developers",
           "License :: OSI Approved :: MIT License",
           "Programming Language :: Python :: 3",
           "Programming Language :: Python :: 3.10",
           "Programming Language :: Python :: 3.11",
           "Programming Language :: Python :: 3.12",
           "Programming Language :: Python :: 3.13",
           "Topic :: Software Development :: Libraries :: Python Modules",
       ]
       ```
    4. Add project URLs:
       ```toml
       [project.urls]
       Homepage = "https://github.com/trace-context/tract"
       Documentation = "https://github.com/trace-context/tract#readme"
       Repository = "https://github.com/trace-context/tract"
       ```
    5. Verify all dependencies are correct and complete:
       - Core: sqlalchemy, pydantic, tiktoken, typing-extensions, httpx, tenacity
       - Optional [cli]: click, rich
       - Dev: pytest, hypothesis, pytest-cov, ruff, mypy, click, rich
    6. Keep `requires-python = ">=3.10"`

    **src/tract/__init__.py** -- Audit and complete public API exports:

    Ensure ALL of these are imported and in `__all__`:
    - `Session` from `tract.session`
    - `SessionContent` from `tract.models.session`
    - `SpawnInfo` from `tract.models.session`
    - `CollapseResult` from `tract.models.session`
    - `SpawnError` from `tract.exceptions`
    - `SessionError` from `tract.exceptions`

    These should already have been added by 05-02. Verify and fix any missing exports.

    Organize `__all__` with a clear section comment for multi-agent types:
    ```python
    # Multi-agent / session
    "Session",
    "SessionContent",
    "SpawnInfo",
    "CollapseResult",
    "SpawnError",
    "SessionError",
    ```

    **src/tract/_version.py** -- Verify version is "0.1.0":
    - The current `__version__` value should already be "0.1.0". Verify and update if needed.
  </action>
  <verify>
    Run `pip install -e .` in the project root -- succeeds without errors.
    Run `python -c "import tract; print(tract.__version__)"` -- prints "0.1.0".
    Run `python -c "from tract import Session, SessionContent, SpawnInfo, CollapseResult, SpawnError, SessionError; print('OK')"` -- all exports work.
    Run `pip install -e '.[cli]'` -- CLI deps install successfully.
    Run `python -m tract --help` or `tract --help` -- CLI entry point responds.
  </verify>
  <done>
    pyproject.toml updated with tract-ai distribution name, complete metadata, classifiers, and URLs. All public API types exported from tract.__init__. Package installs successfully with pip.
  </done>
</task>

<task type="auto">
  <name>Task 2: README documentation and end-to-end integration tests</name>
  <files>
    README.md
    tests/test_integration_multiagent.py
  </files>
  <action>
    **README.md** -- Write comprehensive documentation. The README should include:

    1. **Header and tagline**: "Trace: Git-like version control for LLM context windows"
    2. **Installation**:
       ```
       pip install tract-ai
       # With CLI support:
       pip install tract-ai[cli]
       ```
    3. **Quickstart** (~15 lines of code): Init a tract, commit instruction + dialogue, compile, print messages
    4. **Core Concepts** section (brief descriptions):
       - Tract: A version-controlled context container
       - Commits: Immutable snapshots of context (7 content types)
       - Compile: Reconstruct LLM-ready messages from commit history
       - Branches: Divergent context exploration
       - Compression: Token-budget-aware history summarization
       - Session: Multi-agent coordination
    5. **Single-Agent Example** (~20 lines): Full commit/compile/log cycle
    6. **Multi-Agent Example** (~25 lines): Session.open, spawn, child commits, collapse, timeline
    7. **Session Continuity Example** (~15 lines): SessionContent boundary commit, resume()
    8. **Content Types** table: instruction, dialogue, tool_io, reasoning, artifact, output, freeform, session
    9. **Autonomy Modes**: Brief explanation of manual/collaborative/autonomous
    10. **API Reference Outline**: List of main classes and methods (Tract, Session, key models)
    11. **Development**: How to install dev deps and run tests

    Keep it concise -- aim for ~300 lines total. Focus on working code examples that users can copy-paste.

    Do NOT use emojis anywhere in the README.

    **tests/test_integration_multiagent.py** -- Create end-to-end integration test file (~15 tests):

    1. `test_full_multiagent_workflow`:
       - Open session, create parent tract, commit system instruction + user message
       - Spawn child with head_snapshot
       - Child commits research findings
       - Collapse child back into parent (manual mode with user-provided summary)
       - Verify: parent has spawn commit + collapse commit, child has its commits, timeline has all
       - Verify: parent.children() returns child SpawnInfo, child.parent() returns parent SpawnInfo

    2. `test_recursive_spawn`:
       - Parent spawns child, child spawns grandchild
       - All spawn pointers correct
       - Timeline includes commits from all 3 tracts

    3. `test_multiple_collapse`:
       - Spawn child, child works, collapse (interim), child works more, collapse again
       - Parent has 2 collapse summary commits

    4. `test_session_boundary_commit`:
       - Commit SessionContent with session_type="end"
       - Verify it compiles correctly and is queryable

    5. `test_cross_repo_search`:
       - Create 2 tracts, commit different content
       - search("keyword") finds only matching tract's commits

    6. `test_cross_repo_compile_at`:
       - Create tract, commit at time T1, commit at T2
       - compile_at(tract_id, at_time=T1) returns only T1 context

    7. `test_crash_recovery_integration`:
       - Session.open() with file path, create tract, commit, close session
       - Session.open() again with same path, resume() finds the tract
       - Verify commits still accessible

    8. `test_full_clone_inheritance`:
       - Parent has 5 commits, spawn child with full_clone
       - Child has 5 commits (different hashes) with same content

    9. `test_head_snapshot_inheritance`:
       - Parent has 3 commits, spawn child with head_snapshot
       - Child has 1 initial commit containing compiled parent context

    10. `test_session_list_tracts`:
        - Create 3 tracts, verify list_tracts() returns all 3 with correct metadata

    11. `test_timeline_ordering`:
        - Create 2 tracts, interleave commits with timestamps
        - timeline() returns all commits in chronological order

    12. `test_resume_skips_ended_sessions`:
        - Create 2 tracts, end one with SessionContent(session_type="end")
        - resume() returns the other tract

    13. `test_backward_compatibility`:
        - Tract.open() still works for single-agent use (no Session needed)
        - Tract.parent() returns None, Tract.children() returns []

    14. `test_spawn_with_display_name`:
        - Spawn with display_name, verify it appears in SpawnInfo and list_tracts

    15. `test_session_schema_migration`:
        - Create a v3 database (Phase 4 state), open with Session, verify migration to v4

    All tests use `tmp_path` fixture for file-based databases. Mock LLM client for any tests that would need it (collapse in collaborative/autonomous mode). Focus on real DB operations, not mocks.
  </action>
  <verify>
    Run `python -m pytest tests/test_integration_multiagent.py -v` -- all ~15 integration tests pass.
    Run `python -m pytest tests/ -x -q` -- all tests pass (~631 existing + ~15 new = ~646 total).
    Verify README.md exists and has all sections listed above.
    Run `pip install -e .` and then `python -c "import tract; print(tract.__version__)"` -- confirms installability.
  </verify>
  <done>
    README.md with installation, quickstart, examples (single-agent, multi-agent, session), content types, API outline, and development guide. ~15 end-to-end integration tests covering the complete multi-agent workflow, crash recovery, cross-repo queries, inheritance modes, and backward compatibility. All tests pass. Package is pip-installable.
  </done>
</task>

</tasks>

<verification>
1. `python -m pytest tests/ -x -q` -- all tests pass (~646 total)
2. `pip install -e .` -- package installs successfully
3. `python -c "import tract; print(tract.__version__)"` -- prints 0.1.0
4. `python -c "from tract import Session, Tract, SessionContent, SpawnInfo, CollapseResult"` -- all public API imports work
5. README.md exists with quickstart, examples, and API outline
6. End-to-end test exercises: create session -> spawn -> commit -> collapse -> timeline -> search -> resume
7. `pip install -e '.[cli]' && tract --help` -- CLI works
</verification>

<success_criteria>
1. pyproject.toml has name="tract-ai", correct metadata, classifiers, and URLs
2. pip install -e . and pip install -e '.[cli]' both succeed
3. All public API types exported from tract.__init__ (Session, SessionContent, SpawnInfo, CollapseResult, SpawnError, SessionError)
4. README.md has installation, quickstart, single-agent example, multi-agent example, session continuity, content types, and API outline
5. ~15 end-to-end integration tests cover the complete multi-agent workflow
6. All ~646 tests pass with zero regressions
7. Version is 0.1.0
</success_criteria>

<output>
After completion, create `.planning/phases/05-multi-agent-release/05-03-SUMMARY.md`
</output>
